<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name=viewport
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>HTML5 draw and drag</title>

    <script src="http://code.jquery.com/jquery-1.11.3.min.js">// js/jquery-1.7.min.js"</script>
    <script src="modernizr.custom.34982.js"></script>

    <script src="sketcher.js"></script>
    <!--<script src="js/trigonometry.js"></script>-->

    <link rel="stylesheet" href="assets/bootstrap.css"/>
    <link rel="stylesheet" href="assets/styles.css"/>

    <script>
        var sketcher = null;
        var xC;
        var yC;
        var cursorMode;
        var zoom = 0;
        var canvas;
        var context;
        var image = new Image();
        var svg = [];           // collect the collections here
        var thisSvg = '';            // collect points as strings here
        //image.src = undefined;
        image.src = "../../../../spec/support/images/frost_stage.jpg";
        //          SVG_files\javascripts\assets\app\ to "root" then /spec...
        //image.src = "file:///Users/jrflood/src/taxonworks/spec/support/images/frost_stage.jpg";
        //image.src = 'frost_stage.jpg';
        $(document).ready(function (e) {
            sketcher = new Sketcher("sketch");
//    canvas = document.getElementById("sketch");
//    context = canvas.getContext("2d");
//    setMove();
//    renderImage();
        });

        $(image).load(function () {
            xC = 0;
            yC = 0;
            zoom = 0;
            canvas = document.getElementById("sketch");
            context = canvas.getContext("2d");
            setMove();
            renderImage();
        });

        function clearCanvas() {
            sketcher.clear();
            xC = 0;
            yC = 0;
            renderImage();
        }
        function setDraw() {
            cursorMode = "DRAW";
            indicateMode();
        }

        function setMove() {
            cursorMode = "MOVE";
            indicateMode();
        }

        function indicateMode() {
            document.getElementById("mode").textContent = cursorMode;
        }

        function zoomIn() {
            zoom = zoom + 1;
            var factor = Math.pow(2, zoom);
            $("#zoom").html("Zoom:" + zoom);
//            context.scale(factor, factor);
            renderImage();
        }
        function zoomOut() {
            if (zoom > 0) {
                zoom = zoom - 1;
                var factor = Math.pow(2, zoom);
                $("#zoom").html("Zoom:" + zoom);
//                context.scale(factor, factor);
                renderImage();
            }
        }
//        function panLeft() {
//            xC = xC - 100;
//            renderImage();
//        }
//
//        function panRight() {
//            xC = xC + 100;
//            renderImage();
//        }
//
//        function panUp() {
//            yC = yC - 100;
//            renderImage();
//        }
//
//        function panDown() {
//            yC = yC + 100;
//            renderImage();
//        }

        function renderImage() {
//            if (xC >= image.width - canvas.width) {
//                xC = image.width - canvas.width;
//            }
//    xC, yC is -left, -top boundary of canvas, also source point of image
//    want to window the image into the canvas isometrically
//    and proportional to zoom level

            if ((xC - image.width) * zoom  >= canvas.width) {   // clip on xC
                xC = (image.width - canvas.width) * zoom;
            }
            if (yC >= image.height - canvas.height) {
                yC = image.height - canvas.height;
            }
            if (xC < 0) {
                xC = 0;
            }
            if (yC < 0) {
                yC = 0;
            }
//            context.fillOpacity = "0.0";
            context.clearRect(0, 0, canvas.width, canvas.height);
//            context.drawImage(image, 0, 0, image.width / Math.pow(2, zoom), image.height / Math.pow(2, zoom),
//                    0, 0, canvas.width, canvas.height);
            context.drawImage(image, xC, yC, image.width / Math.pow(2, zoom), image.height / Math.pow(2, zoom),
                    0, 0, canvas.width, canvas.height);
//            context.drawImage(image, xC, yC, image.width, image.height, 0, 0, canvas.width, canvas.height);
//            context.drawImage(image, xC, yC);
//            context.drawImage(image, 0, 0);
            var theseSvgs;
            var element;
            for(i=0; i<svg.length; i++) {
                theseSvgs += svg[i];
            }
            element = svgLayer.appendChild(document.createElementNS(svg,'line'));
            element.innerHTML=theseSvgs;
//            if( this.elt === null )
//            {
//                var svg = 'http://www.w3.org/2000/svg';
//                this.elt = document.createElementNS(svg,'line');
//                this.elt.setAttributeNS(null,'stroke','green');
//                this.elt.setAttributeNS(null,'stroke-width','3');
//                this.elt.setAttributeNS(null,'stroke-opacity','0.5');
//                Display().appendChild( this.elt );
//            }
//
//            this.elt.setAttributeNS(null,'x1',old_x);
//            this.elt.setAttributeNS(null,'y1',old_y);
//
//            this.elt.setAttributeNS(null,'x2',this.x);
//            this.elt.setAttributeNS(null,'y2',this.y);
//        }

        }

        // TODO:
        // bounds check on move (in sketcher.js)
        // aspect ratio compensation source to target canvas
        // capture svg data
        // source image from http://
    </script>
    <style type='text/css'>
        #container {
            overflow: hidden;
            width: 800px;
            height: 600px;
        }
    </style>

</head>

<body>
<div class="topbar-wrapper" style="z-index: 5;">
    <div class="topbar" data-dropdown="dropdown">
        <div class="topbar-inner">
            <div class="container">
                <h3><a href="#">HTML5 drag and draw on canvas</a></h3>

                <ul class="nav">
                    <li class="active"><a href="#">sketch app using "lineTo(x,y)" drawing and moveTo(x,y) dragging</a>
                    </li>
                </ul>

                <ul class="nav secondary-nav">
                    <input type="button" class="btn error" value="clear" onclick="clearCanvas();"/>
                    <input type="button" class="btn error" value="Capture" onclick="sketcher.toString();"/>
                    <input type="button" value="Draw" onclick="setDraw();"/>
                    <span id="mode"></span>
                    <input type="button" value="Move" onclick="setMove();"/>
                    <input type="button" value="Zoom IN" onclick="zoomIn();"/>
                    <span id="zoom">Zoom: 0</span>
                    <input type="button" value="Zoom OUT" onclick="zoomOut();"/>
                    <!--<input type="hidden" id="zoom" value="0" />-->
                    <!--<input type="hidden" id="xC" value="0" />-->
                    <!--<input type="button" value="Down" onclick="panDown();" />-->
                    <!--<input type="button" value="Up" onclick="panUp();" />-->
                    <!--<input type="button" value="Left" onclick="panLeft();" />-->
                    <!--<input type="button" value="Right" onclick="panRight();" />-->
                    <!--<input type="hidden" id="yC" value="0" />-->
                </ul>
            </div>
        </div>
        <!-- /topbar-inner -->
    </div>
    <!-- /topbar -->
</div>
<div id="container">
    <canvas id="sketch" width="800" height="600" style="left: 0; top: 0; position: relative;">
        <svg id="svgLayer" width="800" height="600" xmlns="http://www.w3.org/2000/svg" version="1.1"
             style="left: 0; top: 0; position: relative;">
            <circle id='cursor' cx='250' cy='180' r='20' fill='#ff0000' fill-opacity='1.0'/>
        </svg>
    </canvas>
</div>
</body>
</html>
