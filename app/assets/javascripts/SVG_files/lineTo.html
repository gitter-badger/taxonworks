<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name=viewport
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>HTML5 draw and drag</title>

    <script src="http://code.jquery.com/jquery-1.11.3.min.js">// js/jquery-1.7.min.js"</script>
    <script src="modernizr.custom.34982.js"></script>

    <script src="sketcher.js"></script>
    <!--<script src="js/trigonometry.js"></script>-->

    <link rel="stylesheet" href="assets/bootstrap.css"/>
    <link rel="stylesheet" href="assets/styles.css"/>

    <script>
        var sketcher = null;
        var xS;
        var yS;
        var cursorMode;
        var zoom = 0;
        var canvas;
        var context;
        var image = new Image();
        //image.src = undefined;
        image.src = "../../../../spec/support/images/frost_stage.jpg";
        //          SVG_files\javascripts\assets\app\ to "root" then /spec...
        //image.src = "file:///Users/jrflood/src/taxonworks/spec/support/images/frost_stage.jpg";
        //image.src = 'frost_stage.jpg';
        $(document).ready(function (e) {
            sketcher = new Sketcher("sketch");
//    canvas = document.getElementById("sketch");
//    context = canvas.getContext("2d");
//    setMove();
//    renderImage();
        });

        $(image).load(function () {
            xS = 0;
            yS = 0;
            zoom = 0;
            canvas = document.getElementById("sketch");
            context = canvas.getContext("2d");
            setMove();
            renderImage();
        });

        function clearCanvas() {
            sketcher.clear();
            xS = 0;
            yS = 0;
            renderImage();
        }
        function setDraw() {
            cursorMode = "DRAW";
            indicateMode();
        }

        function setMove() {
            cursorMode = "MOVE";
            indicateMode();
        }

        function indicateMode() {
            document.getElementById("mode").textContent = cursorMode;
        }

        function zoomIn() {
            zoom = zoom + 1;
            var factor = Math.pow(2, zoom);
            $("#zoom").html("Zoom:" + zoom);
            context.scale(factor, factor);
//            renderImage();
        }
        function zoomOut() {
            if (zoom > 0) {
                zoom = zoom - 1;
                var factor = Math.pow(2, zoom);
                $("#zoom").html("Zoom:" + zoom);
                context.scale(factor, factor);
//                renderImage();
            }
        }
        function panLeft() {
            xS = xS - 100;
            renderImage();
        }

        function panRight() {
            xS = xS + 100;
            renderImage();
        }

        function panUp() {
            yS = yS - 100;
            renderImage();
        }

        function panDown() {
            yS = yS + 100;
            renderImage();
        }

        function renderImage() {
            if (xS >= image.width - canvas.width) {
                xS = image.width - canvas.width;
            }
            if (yS >=  image.height - canvas.height) {
                yS = image.height - canvas.height;
            }
            if (xS < 0) {
                xS = 0;
            }
            if (yS < 0) {
                yS = 0;
            }

//            context.drawImage(image, xS, yS, image.width / Math.pow(2, zoom), image.height / Math.pow(2, zoom),
//                    0, 0, canvas.width, canvas.height);
//            context.drawImage(image, xS, yS, image.width, image.height, 0, 0, canvas.width, canvas.height);
            context.drawImage(image, xS, yS);
        }

        // TODO:
        // bounds check on move (in sketcher.js)
        // aspect ratio compensation source to target canvas
        // capture svg data
        // source image from http://
    </script>

</head>

<body>
<div class="topbar-wrapper" style="z-index: 5;">
    <div class="topbar" data-dropdown="dropdown">
        <div class="topbar-inner">
            <div class="container">
                <h3><a href="#">HTML5 drag and draw on canvas</a></h3>

                <ul class="nav">
                    <li class="active"><a href="#">sketch app using "lineTo(x,y)" drawing and moveTo(x,y) dragging</a>
                    </li>
                </ul>

                <ul class="nav secondary-nav">
                    <input type="button" class="btn error" value="clear" onclick="clearCanvas();"/>
                    <input type="button" class="btn error" value="Capture" onclick="sketcher.toString();"/>
                    <input type="button" value="Draw" onclick="setDraw();"/>
                    <span id="mode"></span>
                    <input type="button" value="Move" onclick="setMove();"/>
                    <input type="button" value="Zoom IN" onclick="zoomIn();"/>
                    <span id="zoom">Zoom: 0</span>
                    <input type="button" value="Zoom OUT" onclick="zoomOut();"/>
                    <!--<input type="hidden" id="zoom" value="0" />-->
                    <!--<input type="hidden" id="xS" value="0" />-->
                    <!--<input type="button" value="Down" onclick="panDown();" />-->
                    <!--<input type="button" value="Up" onclick="panUp();" />-->
                    <!--<input type="button" value="Left" onclick="panLeft();" />-->
                    <!--<input type="button" value="Right" onclick="panRight();" />-->
                    <!--<input type="hidden" id="yS" value="0" />-->
                </ul>
            </div>
        </div>
        <!-- /topbar-inner -->
    </div>
    <!-- /topbar -->
</div>
<canvas id="sketch" width="1024" height="640"></canvas>
</body>
</html>
